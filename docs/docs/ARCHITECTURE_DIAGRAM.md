# GitaGPT Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                    (Next.js + React + Tailwind)                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Chat    â”‚  â”‚  Mode    â”‚  â”‚  Dark    â”‚  â”‚  Session â”‚      â”‚
â”‚  â”‚  Input   â”‚  â”‚ Selector â”‚  â”‚  Mode    â”‚  â”‚  Manager â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Message Display Area                        â”‚     â”‚
â”‚  â”‚  â€¢ User messages                                      â”‚     â”‚
â”‚  â”‚  â€¢ AI responses with verses                          â”‚     â”‚
â”‚  â”‚  â€¢ Emotion indicators                                â”‚     â”‚
â”‚  â”‚  â€¢ Loading states                                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/REST API
                              â”‚ (with Firebase Auth)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY (FastAPI)                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Authentication Middleware                    â”‚ â”‚
â”‚  â”‚         (Firebase JWT Token Verification)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Chat Orchestration API                   â”‚ â”‚
â”‚  â”‚                    (/api/v1/chat/)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTENT CLASSIFICATION                        â”‚
â”‚                  (facebook/bart-large-mnli)                     â”‚
â”‚                                                                 â”‚
â”‚  Input: "I'm feeling anxious"                                  â”‚
â”‚  Output: emotional_query (confidence: 0.89)                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ casual_chat  â”‚  â”‚ emotional_   â”‚  â”‚ spiritual_   â”‚        â”‚
â”‚  â”‚              â”‚  â”‚ query        â”‚  â”‚ guidance     â”‚        â”‚
â”‚  â”‚ 40-60% of    â”‚  â”‚ 30-40% of    â”‚  â”‚ 10-20% of    â”‚        â”‚
â”‚  â”‚ queries      â”‚  â”‚ queries      â”‚  â”‚ queries      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â”‚                    â”‚                    â”‚
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CASUAL CHAT   â”‚  â”‚  EMOTIONAL     â”‚  â”‚  SPIRITUAL     â”‚
â”‚  PIPELINE      â”‚  â”‚  PIPELINE      â”‚  â”‚  PIPELINE      â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚  Skip emotion  â”‚  â”‚  âœ“ Emotion     â”‚  â”‚  Skip emotion  â”‚
â”‚  Skip verses   â”‚  â”‚  âœ“ Verses      â”‚  â”‚  âœ“ Verses      â”‚
â”‚  âœ“ Gemini      â”‚  â”‚  âœ“ Gemini      â”‚  â”‚  âœ“ Gemini      â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚  1-2s          â”‚  â”‚  3-5s          â”‚  â”‚  2-4s          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â”‚                    â†“                    â”‚
         â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
         â”‚          â”‚    EMOTION     â”‚            â”‚
         â”‚          â”‚   DETECTION    â”‚            â”‚
         â”‚          â”‚   (RoBERTa)    â”‚            â”‚
         â”‚          â”‚                â”‚            â”‚
         â”‚          â”‚  Input: text   â”‚            â”‚
         â”‚          â”‚  Output:       â”‚            â”‚
         â”‚          â”‚  - label       â”‚            â”‚
         â”‚          â”‚  - confidence  â”‚            â”‚
         â”‚          â”‚  - emoji       â”‚            â”‚
         â”‚          â”‚  - color       â”‚            â”‚
         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
         â”‚                    â”‚                    â”‚
         â”‚                    â†“                    â†“
         â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          â”‚     VECTOR SEARCH           â”‚
         â”‚          â”‚      (ChromaDB)             â”‚
         â”‚          â”‚                             â”‚
         â”‚          â”‚  â€¢ Semantic similarity      â”‚
         â”‚          â”‚  â€¢ Emotion-aware search     â”‚
         â”‚          â”‚  â€¢ Top-k retrieval          â”‚
         â”‚          â”‚                             â”‚
         â”‚          â”‚  Input: query + emotion     â”‚
         â”‚          â”‚  Output: relevant verses    â”‚
         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RESPONSE GENERATION                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Casual     â”‚  â”‚  Reflection  â”‚  â”‚  Reflection  â”‚        â”‚
â”‚  â”‚   Chat       â”‚  â”‚  Generation  â”‚  â”‚  Generation  â”‚        â”‚
â”‚  â”‚   Service    â”‚  â”‚  Service     â”‚  â”‚  Service     â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â”‚  Gemini API  â”‚  â”‚  Gemini API  â”‚  â”‚  Gemini API  â”‚        â”‚
â”‚  â”‚  (short      â”‚  â”‚  (full       â”‚  â”‚  (verse      â”‚        â”‚
â”‚  â”‚   prompt)    â”‚  â”‚   prompt)    â”‚  â”‚   focused)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  Fallback: Template-based responses if API fails               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA PERSISTENCE                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚   ChromaDB   â”‚  â”‚   Firebase   â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â”‚ â€¢ Users      â”‚  â”‚ â€¢ Verses     â”‚  â”‚ â€¢ Auth       â”‚        â”‚
â”‚  â”‚ â€¢ Sessions   â”‚  â”‚ â€¢ Embeddings â”‚  â”‚ â€¢ Tokens     â”‚        â”‚
â”‚  â”‚ â€¢ Messages   â”‚  â”‚ â€¢ Metadata   â”‚  â”‚              â”‚        â”‚
â”‚  â”‚ â€¢ Emotions   â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Flow Examples

### Example 1: Casual Chat

```
User: "Hello!"
  â†“
Frontend â†’ API Gateway â†’ Intent Classifier
  â†“
Intent: casual_chat (0.95)
  â†“
Casual Chat Service â†’ Gemini API
  â†“
Response: "ğŸ™ Namaste! I'm GitaGPT..."
  â†“
Frontend displays response
  â†“
Total time: 1-2 seconds
```

### Example 2: Emotional Query

```
User: "I'm feeling very anxious about my future"
  â†“
Frontend â†’ API Gateway â†’ Intent Classifier
  â†“
Intent: emotional_query (0.89)
  â†“
Emotion Detection (RoBERTa)
  â†“
Emotion: anxiety (0.78) ğŸ˜°
  â†“
Vector Search (ChromaDB)
  â†“
Verses: [BG2.47, BG2.48, BG2.50]
  â†“
Reflection Generation (Gemini)
  â†“
Response: "I sense your anxiety... [verse] [guidance]"
  â†“
Store in database (conversation + mood log)
  â†“
Frontend displays: emotion + verses + reflection
  â†“
Total time: 3-5 seconds
```

### Example 3: Spiritual Guidance

```
User: "What does Krishna say about dharma?"
  â†“
Frontend â†’ API Gateway â†’ Intent Classifier
  â†“
Intent: spiritual_guidance (0.92)
  â†“
Skip emotion detection
  â†“
Vector Search (ChromaDB)
  â†“
Verses: [BG3.35, BG18.47, BG2.31]
  â†“
Reflection Generation (Gemini)
  â†“
Response: "Krishna teaches that dharma... [verses] [explanation]"
  â†“
Store in database (conversation only)
  â†“
Frontend displays: verses + reflection
  â†“
Total time: 2-4 seconds
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND LAYER                           â”‚
â”‚                                                                 â”‚
â”‚  React Components:                                              â”‚
â”‚  â€¢ ChatInterface (main component)                               â”‚
â”‚  â€¢ MessageList (displays conversation)                          â”‚
â”‚  â€¢ InputArea (user input)                                       â”‚
â”‚  â€¢ ModeSelector (wisdom/socratic/story)                         â”‚
â”‚  â€¢ EmotionIndicator (shows detected emotion)                    â”‚
â”‚  â€¢ VerseCard (displays verses)                                  â”‚
â”‚                                                                 â”‚
â”‚  API Client (lib/api.js):                                       â”‚
â”‚  â€¢ sendChatMessage()                                            â”‚
â”‚  â€¢ createSession()                                              â”‚
â”‚  â€¢ getConversationContext()                                     â”‚
â”‚  â€¢ endSession()                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ REST API
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API LAYER                               â”‚
â”‚                                                                 â”‚
â”‚  Endpoints:                                                     â”‚
â”‚  â€¢ POST /api/v1/chat/                                          â”‚
â”‚  â€¢ POST /api/v1/conversations/sessions                         â”‚
â”‚  â€¢ GET  /api/v1/conversations/{id}/context                     â”‚
â”‚  â€¢ POST /api/v1/conversations/{id}/end                         â”‚
â”‚  â€¢ GET  /api/v1/chat/health                                    â”‚
â”‚                                                                 â”‚
â”‚  Middleware:                                                    â”‚
â”‚  â€¢ Authentication (Firebase JWT)                                â”‚
â”‚  â€¢ CORS                                                         â”‚
â”‚  â€¢ Error handling                                               â”‚
â”‚  â€¢ Logging                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVICE LAYER                             â”‚
â”‚                                                                 â”‚
â”‚  Core Services:                                                 â”‚
â”‚  â€¢ IntentClassificationService                                  â”‚
â”‚  â€¢ EmotionDetectionService                                      â”‚
â”‚  â€¢ VectorSearchService                                          â”‚
â”‚  â€¢ ReflectionGenerationService                                  â”‚
â”‚  â€¢ CasualChatService                                            â”‚
â”‚  â€¢ ConversationManager                                          â”‚
â”‚  â€¢ LoggingService                                               â”‚
â”‚                                                                 â”‚
â”‚  Each service is:                                               â”‚
â”‚  â€¢ Singleton pattern                                            â”‚
â”‚  â€¢ Dependency injection                                         â”‚
â”‚  â€¢ Error handling with fallbacks                                â”‚
â”‚  â€¢ Async/await support                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                               â”‚
â”‚                                                                 â”‚
â”‚  Models (SQLAlchemy):                                           â”‚
â”‚  â€¢ User                                                         â”‚
â”‚  â€¢ ConversationSession                                          â”‚
â”‚  â€¢ ConversationMessage                                          â”‚
â”‚  â€¢ EmotionLog                                                   â”‚
â”‚  â€¢ Verse (metadata)                                             â”‚
â”‚                                                                 â”‚
â”‚  Repositories:                                                  â”‚
â”‚  â€¢ PostgreSQL (structured data)                                 â”‚
â”‚  â€¢ ChromaDB (vector embeddings)                                 â”‚
â”‚  â€¢ Firebase (authentication)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                â”‚
â”‚                                                                 â”‚
â”‚  Framework:     Next.js 14 (React 18)                          â”‚
â”‚  Styling:       Tailwind CSS                                    â”‚
â”‚  Icons:         Lucide React                                    â”‚
â”‚  Auth:          Firebase Client SDK                             â”‚
â”‚  State:         React Hooks (useState, useEffect)               â”‚
â”‚  HTTP:          Fetch API                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                                 â”‚
â”‚                                                                 â”‚
â”‚  Framework:     FastAPI (Python 3.8+)                          â”‚
â”‚  Server:        Uvicorn (ASGI)                                  â”‚
â”‚  Database:      PostgreSQL + SQLAlchemy                         â”‚
â”‚  Vector DB:     ChromaDB                                        â”‚
â”‚  Auth:          Firebase Admin SDK                              â”‚
â”‚  Validation:    Pydantic                                        â”‚
â”‚  Migrations:    Alembic                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI/ML MODELS                             â”‚
â”‚                                                                 â”‚
â”‚  Intent:        facebook/bart-large-mnli                        â”‚
â”‚                 (Zero-shot classification)                      â”‚
â”‚                                                                 â”‚
â”‚  Emotion:       SamLowe/roberta-base-go_emotions               â”‚
â”‚                 (ONNX optimized, 28 emotions)                   â”‚
â”‚                                                                 â”‚
â”‚  Embeddings:    all-mpnet-base-v2                              â”‚
â”‚                 (Sentence transformers)                         â”‚
â”‚                                                                 â”‚
â”‚  LLM:           Google Gemini 2.0 Flash                        â”‚
â”‚                 (Response generation)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRODUCTION SETUP                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Load Balancer                          â”‚ â”‚
â”‚  â”‚                   (Nginx / Caddy)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â†“                               â†“                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Frontend Server  â”‚          â”‚   Backend Server   â”‚       â”‚
â”‚  â”‚   (Next.js)        â”‚          â”‚   (FastAPI)        â”‚       â”‚
â”‚  â”‚   Port: 3000       â”‚          â”‚   Port: 8000       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                              â”‚                  â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                              â†“               â†“               â†“ â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”â”‚
â”‚                  â”‚  PostgreSQL  â”‚  â”‚   ChromaDB   â”‚  â”‚ Fire â”‚â”‚â”‚
â”‚                  â”‚   Database   â”‚  â”‚  Vector DB   â”‚  â”‚ base â”‚â”‚â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                            â”‚
â”‚                                                                 â”‚
â”‚  Layer 1: Authentication                                        â”‚
â”‚  â€¢ Firebase JWT tokens                                          â”‚
â”‚  â€¢ Token verification on every request                          â”‚
â”‚  â€¢ User session management                                      â”‚
â”‚                                                                 â”‚
â”‚  Layer 2: Authorization                                         â”‚
â”‚  â€¢ User can only access own data                                â”‚
â”‚  â€¢ Session ownership verification                               â”‚
â”‚  â€¢ Role-based access (future)                                   â”‚
â”‚                                                                 â”‚
â”‚  Layer 3: Data Protection                                       â”‚
â”‚  â€¢ HTTPS in production                                          â”‚
â”‚  â€¢ Environment variables for secrets                            â”‚
â”‚  â€¢ Database connection encryption                               â”‚
â”‚  â€¢ API key rotation                                             â”‚
â”‚                                                                 â”‚
â”‚  Layer 4: Rate Limiting                                         â”‚
â”‚  â€¢ Per-user request limits                                      â”‚
â”‚  â€¢ API endpoint throttling                                      â”‚
â”‚  â€¢ DDoS protection                                              â”‚
â”‚                                                                 â”‚
â”‚  Layer 5: Input Validation                                      â”‚
â”‚  â€¢ Pydantic models                                              â”‚
â”‚  â€¢ SQL injection prevention                                     â”‚
â”‚  â€¢ XSS protection                                               â”‚
â”‚  â€¢ CORS configuration                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Monitoring & Observability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONITORING STACK                             â”‚
â”‚                                                                 â”‚
â”‚  Metrics:                                                       â”‚
â”‚  â€¢ Response times by intent                                     â”‚
â”‚  â€¢ API call counts                                              â”‚
â”‚  â€¢ Error rates                                                  â”‚
â”‚  â€¢ Fallback usage                                               â”‚
â”‚  â€¢ Database query performance                                   â”‚
â”‚                                                                 â”‚
â”‚  Logging:                                                       â”‚
â”‚  â€¢ Structured JSON logs                                         â”‚
â”‚  â€¢ Log levels (DEBUG, INFO, WARNING, ERROR)                     â”‚
â”‚  â€¢ Request/response logging                                     â”‚
â”‚  â€¢ Error stack traces                                           â”‚
â”‚                                                                 â”‚
â”‚  Alerts:                                                        â”‚
â”‚  â€¢ High error rates                                             â”‚
â”‚  â€¢ Slow response times                                          â”‚
â”‚  â€¢ Database connection issues                                   â”‚
â”‚  â€¢ API quota warnings                                           â”‚
â”‚                                                                 â”‚
â”‚  Analytics:                                                     â”‚
â”‚  â€¢ User engagement metrics                                      â”‚
â”‚  â€¢ Intent distribution                                          â”‚
â”‚  â€¢ Emotion trends                                               â”‚
â”‚  â€¢ Popular verses                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This architecture provides**:
- âœ… Scalability through microservices pattern
- âœ… Performance through intelligent routing
- âœ… Reliability through multiple fallback layers
- âœ… Security through multi-layer protection
- âœ… Observability through comprehensive monitoring

**Ready for production deployment!** ğŸš€
